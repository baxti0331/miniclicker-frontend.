<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Clicker —Å —Ä–µ—Ñ–µ—Ä–∞–ª–∫–æ–π</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #coin-button { font-size: 40px; cursor: pointer; margin: 20px; padding: 20px; background: gold; border-radius: 50%; display: inline-block; }
    .hidden { display: none; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>

<h1>Mini Clicker —Å —Ä–µ—Ñ–µ—Ä–∞–ª–∫–æ–π</h1>

<div>–ú–æ–Ω–µ—Ç: <span id="coins">0</span></div>
<div>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥: <input id="referralInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ (–µ—Å–ª–∏ –µ—Å—Ç—å)" /></div>
<button id="startBtn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>

<div id="game" class="hidden">
  <div id="coin-button">ü™ô</div>
  <div>–ö–ª–∏–∫–∏: <span id="clicks">0</span></div>

  <h3>–ü–æ–∫—É–ø–∫–∏</h3>
  <button id="buyAutoClickerBtn">–ö—É–ø–∏—Ç—å –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä (50 –º–æ–Ω–µ—Ç)</button>
</div>

<script>
  const backendURL = 'https://miniclicker-backend.onrender.com'; // –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π URL –±–µ–∫–µ–Ω–¥–∞
  let userId = null;
  let coins = 0;
  let clicks = 0;

  const coinsElem = document.getElementById('coins');
  const clicksElem = document.getElementById('clicks');
  const referralInput = document.getElementById('referralInput');
  const startBtn = document.getElementById('startBtn');
  const gameDiv = document.getElementById('game');
  const coinButton = document.getElementById('coin-button');
  const buyAutoClickerBtn = document.getElementById('buyAutoClickerBtn');

  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º userId (–º–æ–∂–Ω–æ –ø–æ–∑–∂–µ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –ª–æ–≥–∏–Ω)
  function generateUserId() {
    return 'user_' + Math.random().toString(36).substr(2, 9);
  }

  startBtn.onclick = async () => {
    userId = localStorage.getItem('userId') || generateUserId();
    localStorage.setItem('userId', userId);

    const referralCode = referralInput.value.trim() || null;

    // –°–æ–∑–¥–∞—ë–º –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const res = await fetch(backendURL + '/api/user', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ userId, referralCode })
    });
    const data = await res.json();

    if (data.user) {
      coins = data.user.coins;
      updateUI();
      startBtn.style.display = 'none';
      referralInput.style.display = 'none';
      gameDiv.classList.remove('hidden');
    }
  };

  coinButton.onclick = async () => {
    clicks++;
    clicksElem.textContent = clicks;

    // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–Ω–µ—Ç—ã —á–µ—Ä–µ–∑ –±–µ–∫–µ–Ω–¥
    const res = await fetch(backendURL + '/api/addCoins', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ userId, amount: 1 })
    });
    const data = await res.json();
    if (data.coins != null) {
      coins = data.coins;
      updateUI();
    }
  };

  buyAutoClickerBtn.onclick = async () => {
    if (coins < 50) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–∞!');

    const res = await fetch(backendURL + '/api/buy', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ userId, cost: 50 })
    });
    const data = await res.json();
    if (data.success) {
      coins = data.coins;
      updateUI();
      alert('–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –∫—É–ø–ª–µ–Ω!');
    } else {
      alert(data.error || '–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏');
    }
  };

  function updateUI() {
    coinsElem.textContent = coins;
  }
</script>

</body>
</html>